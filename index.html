<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="uid" style="display: none"></div>
    <button type="button" id="startButton" hx-get="/start" hx-trigger="click" hx-target="#uid" hx-vals='{"rotation": "", "location": ""}'>Start</button>

    <div class="p-3 mb-2 bg-secondary" id="demo-div">
      <p style="margin-top:1rem;">Num. of datapoints: <span class="badge badge-warning" id="num-observed-events">0</span></p>


      <h4 style="margin-top:0.75rem;">Orientati</h4>
      <ul>
        <li>X-axis (&beta;): <span id="Orientation_b">0</span><span>&deg;</span></li>
        <li>Y-axis (&gamma;): <span id="Orientation_g">0</span><span>&deg;</span></li>
        <li>Z-axis (&alpha;): <span id="Orientation_a">0</span><span>&deg;</span></li>
      </ul>

      <h4 style="margin-top:0.75rem;">Tipo</h4>
      <ul>
        <li>Que tipo es? <span id="typee">Ni idea</span></li>
      </ul>

    
    </div>
    <script>


    const button = document.getElementById('startButton');
    let hxVals = button.getAttribute('hx-vals');
    let hxValsObject = JSON.parse(hxVals);

    if (
      DeviceMotionEvent &&
      typeof DeviceMotionEvent.requestPermission === "function"
      ) {
        DeviceMotionEvent.requestPermission();
      }
    window.addEventListener("deviceorientation", handleOrientation);
    document.getElementById("start_demo").innerHTML = "Stop demo";
    demo_button.classList.remove('btn-success');
    demo_button.classList.add('btn-danger');
    is_running = true;
    
    document.getElementById("uid");
    var userId;
    document.body.addEventListener('htmx:afterSwap', function(evt) {
      userId = evt.detail.target.innerHTML;
    });
    
    function handleOrientation(event) {
      // updateFieldIfNotNull('typee', typeof event.gamma); Esto falla
      const orientationData = {
        alpha: event.alpha,
        beta: event.beta,
        gamma: event.gamma
      };
        
      if (button) {
        // Update the rotation value
        hxValsObject.rotation = orientationData;
  
        // Convert the JavaScript object back to a JSON string
        const updatedHxVals = JSON.stringify(hxValsObject);
  
        // Set the updated hx-vals attribute back to the button
        button.setAttribute('hx-vals', updatedHxVals);
      }
  
      document.getElementById("")
  
      updateFieldIfNotNull('Orientation_a', event.alpha);
      updateFieldIfNotNull('Orientation_b', event.beta);
      updateFieldIfNotNull('Orientation_g', event.gamma);

      incrementEventCount();
    }
  
    function incrementEventCount(){
      let counterElement = document.getElementById("num-observed-events")
      let eventCount = parseInt(counterElement.innerHTML)
      counterElement.innerHTML = eventCount + 1;
    }

    function updateFieldIfNotNull(fieldName, value, precision=1){
      if (value != null)
        document.getElementById(fieldName).innerHTML = value.toFixed(precision);
    }

    function triggerButtonClick() {
        button.click();
    }

    // Use setInterval to call the triggerButtonClick function every 5 seconds (5000 milliseconds)
    setInterval(triggerButtonClick, 500);
  </script>
  </body>
</html>